<!DOCTYPE html>
<html>
<head>
  <script src="processing-1.3.6-api.js"></script>
  <title>Delauney Triangulation</title>
  
<body>
<h2>Circumcircles</h2>
<p>
Mouse buttons (left, right, middle) to move the three points!
</p>
<link href="style.css" rel="stylesheet" type="text/css"/>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script type="text/javascript" src="geoLibrary.js"></script>
<script type="text/javascript">

/*********Globals**********/

$j = jQuery.noConflict();
var fileText;
var theta = 0;
var canvas;
var p;
var point1,point2,point3;
var circle;

var allVertices = {};
var allLinks = {};

var maxVertexX = Number.MIN_VALUE;
var maxVertexY = Number.MIN_VALUE;


function eraseCircle() {
	circle.radius = 0;
	circle.x = -10;
}


function sketchProc(processing) {
  // Override draw function, by default it will be called 60 times per second
    processing.draw = function() {

        // erase background
        p.background(224);
        
        //calc the circle thing
        theta += 0.007;
        
        var y = (Math.sin(theta)/2 + 0.5) * p.height * 0.8 + 0.1 * p.height;
        point2.y = y;
        var x = (Math.cos(theta*1.333)/2 + 0.5) * p.width * 0.8 + 0.1 * p.width;
        point3.x = x;
        
        var newC = Circle.prototype.circleFromPoints(point1,point2,point3);
        //only reassign if valid triangle
        if(newC) { circle = newC; }
        
        p.strokeWeight(4);
        //p.noFill();
        circle.draw();
            
        p.strokeWeight(8);
        p.stroke(p.color(255,0,0));
        point1.draw();
        p.stroke(p.color(0,255,0));
        point2.draw();
        p.stroke(p.color(0,0,255));
        point3.draw();

        p.stroke(p.color(0,0,0,50));
        p.strokeWeight(2);
        p.line(point1.x,point1.y,point2.x,point2.y);
        p.line(point2.x,point2.y,point3.x,point3.y);
        p.line(point3.x,point3.y,point1.x,point1.y);


        p.strokeWeight(8);
        p.stroke(p.color(0,0,0,255));
        
        
        //draw the actual DT stuff
        for(key in allVertices)
        {
            allVertices[key].draw();
        }

        p.strokeWeight(2);
        for(key in allLinks)
        {
            var l = allLinks[key];

            l.draw();
        }
        p.popMatrix();

    };
    
    processing.setup = function() {
        processing.width = 800;
        processing.height = 600;
        processing.background(224)
    };

    processing.mouseDragged = function() {
	    if(p.__mousePressed)
        {
		   p.mouseClicked();
        }
    };
    
    processing.mouseClicked = function() {
        //console.log("button" + p.mouseButton);

        if(p.mouseButton == 37)
        {
            //left click
            setPointPos(point1,p.mouseX,p.mouseY);
        }
        else if(p.mouseButton == 3)
        {
            //right click
            setPointPos(point2,p.mouseX,p.mouseY);
        }
        else if(p.mouseButton == 39)
        {
            //middle click? this is actually right
            setPointPos(point3,p.mouseX,p.mouseY);
        }

    };
}

function setPointPos(point,x,y)
{
	point.x = x;
	point.y = y;
}

function loadFile()
{
    fileText = $j('#inputFile').val();

    var numVerticesResult = /(\d+)/.exec(fileText);
    if(!numVerticesResult)
    {
        alert("something seems to be wrong with your file input");
        return;
    }
    var numVertices = numVerticesResult[0];
    console.log("number of vertices :" + numVertices);
    
    var lines = fileText.split('\n');
    lines.splice(0,1);
    
    readInVertices(numVertices,lines);
}

function readInVertices(numVertices,lines)
{
    try{

        allVertices = {};

        //1-indexing >___________<
        for(var i = 0; i <= lines.length; i++)
        {
            var theLine = lines[i];

            //regex for (1 - number of vertex) (2- x coord) (3- y coord)
            var results = /\s*(\d+)\s+([.0-9]+)\s+([.0-9]+)/.exec(theLine);

            if(!results)
            {
                continue;
            }

            var vertexNum = Number(results[1]);
            var xCoord = Number(results[2]);
            var yCoord = Number(results[3]);

            if(xCoord > maxVertexX)
            {
                maxVertexX = xCoord;
            }

            if(yCoord > maxVertexY)
            {
                maxVertexY = yCoord;
            }

            //make a new vertex and assign it
            allVertices[vertexNum] = new Vertex(vertexNum,xCoord,yCoord);
        }

    }
    catch(err)
    {
        alert("Something seems to be wrong with your input file format!");
        throw err;
    }
    //now add each vertex to each link as a test
    testLinks();
}

function testLinks()
{
    for(key in allVertices)
    {
        var v = allVertices[key];
        var l = new Link(v);

        for(key2 in allVertices)
        {
            var j = allVertices[key2];
            if(v != j)
            {
                //make add vertex
                l.addVertex(j);
            }
        }

        /*
        console.log("making this link");
        console.log(l);
        console.log("against this vertex");
        console.log(v);
        */

        allLinks[v.id] = l;
        v.myLink = l;
    }
}

// attaching the sketchProc function to the canvas

$j(document).ready(function(){
    canvas = document.getElementById("canvas1");
    p = new Processing(canvas, sketchProc);
    
    point1 = new Point(p.random(0,p.width),p.random(0,p.height));
    point2 = new Point(p.random(0,p.width),p.random(0,p.height));
    point3 = new Point(p.random(0,p.width),p.random(0,p.height));

    circle = new Circle(0,0,0);

    var testFile = "12 2 0 0\n1 0 0\n2 0 3\n3 3 0\n 4 3 3\n5 1 1 \n 6 1 2\n7 2 1 \n 8 2 2 \n 9 0 1.5\n 10 1.5 0\n11 3 1.5\n 12 1.5 3";
    $j('#inputFile').val(testFile);
    loadFile();

});


</script>
<div style="text-align:center;">
    <canvas id="canvas1" width="600" height="800"></canvas></p>

    <table>
        <tr>
            <td>
    <textarea id="inputFile" rows="4" cols="80">Enter your .node file here
    </textarea>
            </td>
            <td>
                <div style="width:30px"></div>
            </td>
            <td>
    <textarea id="outputFile" rows="4" cols="80">Output area
    </textarea>
            </td>
        </tr>
        <tr>
            <td>
            <button onclick="javascript:loadFile()">Load File</button>
            </td>
        </tr>
        
    </table>

</div>

</body>
</html>
